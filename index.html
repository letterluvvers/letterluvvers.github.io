<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Home</title>
	<!-- <link rel="stylesheet" href="css/style.css"> -->

	<link rel="preconnect" href="https://fonts.googleapis.com"> 
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
	<link href="https://fonts.googleapis.com/css2?family=Libre+Caslon+Text:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

	<style>


:root {
	--panel-background-color: rgb(252, 237, 199);
	font-family: "Libre Caslon Text", serif;
	font-size: 24px;
}

body {
	margin-top: 10px;
	padding: 0;
	background-color: grey;
	display: grid;
	line-height: 1.5;
	grid-template-columns: 1fr min(1040px, calc(100% - 30px)) 1fr;
}

h1, h2 {
	margin: 0;
}

main {
	/* background-color: black; */
}

header {
}

footer {
	text-align: center;
}

.event {
	display: grid;
	grid-template-columns: 1fr 1fr;
}

.bubble {
	background-color: var(--panel-background-color);
	border-radius: 15px;
	padding: 25px;
	margin-bottom: 25px;
	filter: drop-shadow(5px 5px 10px #000);
}

.event .right {
	/* text-align: right; */
}

.social-logo {
	height: 24px;
}


	</style>
</head>

<body>

	<div id="left"></div>

	<main>

	<header class="bubble">
	<!-- <h1>Letter Luvvers</h1> -->
	<h1><img src="images/Letter-Luvvers-logo.svg" width="100%" alt="Letter Luvvers" title="Letter Luvvers"></h1>
	<p style="font-size:115%; text-align: center; border-top: 1px solid black; padding-top: 5px; padding-bottom: 5px; border-bottom: 1px solid black; "><em>Bristol’s meet-up group for everyone who loves fonts &amp; lettering</em></p>
	<p>We are lettering artists, signpainters, typeface designers, letterpress printers, calligraphers, typographers, tattooists, font technologists, font fans, and more. We get together for drinks and networking every two months.</p>
	<p>Letter Luvvers events start with short talks, then people stay as long as they like. They’re on weekday evenings, and they’re free. If you’d like to come, please sign up on EventBrite so we can judge numbers and contact you in case of important updates.
		Follow us on <a href="https://www.eventbrite.co.uk/o/letter-luvvers-49388686583" target="_blank">Eventbrite</a>, <a href="https://www.instagram.com/letterluvvers" target="_blank">Instagram</a> or <a href="https://discord.com/channels/1068105372587540551/" target="_blank">Discord</a> to hear about future events. There’s no profit motive, just bringing people of related passions together.</p>
	</header>

	<div id="events">
	</div>


	<footer class="bubble">
		<p style="word-spacing: 105%;">
		<a href="mailto:letterluvvers@gmail.com" title="Email"><img class="social-logo" src="images/logo-email.png"></a>
		<a href="https://www.eventbrite.co.uk/o/letter-luvvers-49388686583" target="_blank" title="Eventbrite"><img class="social-logo" src="images/logo-eventbrite.png"></a>
		<a href="https://twitter.com/letterluvvers" target="_blank" title="Twitter"><img class="social-logo" src="images/logo-twitter.png"></a>
		<a href="https://discord.com/channels/1068105372587540551/" target="_blank" title="Discord"><img class="social-logo" src="images/logo-discord.png"></a>
		<a href="https://www.instagram.com/letterluvvers" target="_blank" title="Instagram"><img class="social-logo" src="images/logo-instagram.png"></a>
		</p>
		<p>© Letter Luvvers 2023</p>
	</footer>
	</main>

	<div id="right"></div>
</body>


<script>

// get images for a path, starting at image0.jpg
// element is the HTML element that we append the image to
async function getImages (path, element) {


	function _arrayBufferToBase64(buf) {
		let binary = "";
		const bytes = new Uint8Array(buf);
		const len = bytes.byteLength;
		for (let i = 0; i < len; i++) {
			binary += String.fromCharCode( bytes[i] );
		}
		return window.btoa( binary );
	}

	let imageNum = 0;
	let moreImages = true;
	while (moreImages) {
		const imagePath = path + "/image-" + imageNum + ".jpg";
		console.log(imagePath);
		const response = await fetch(imagePath);
		//console.log(response)
		if (response.ok) {
			const arrayBuffer = await response.arrayBuffer();
			console.log("yes1");
			if (arrayBuffer) {
				console.log("yes2");
				const img = document.createElement("img");
				img.src = "data:image/jpg;base64," + _arrayBufferToBase64(arrayBuffer);
				img.height = 300;
				img.style.marginLeft = "10px";
				console.log(element)
				element.append(img);
			}
			imageNum++;
		}
		else {
			console.log("no");
			moreImages = false;
		}
	}

	//const response = await fetch(fontPath);
			





}


const dataCache = [
	{name: "2022-07-20", path: "events/2022-07-20", speakers: ["Toshi Omagari", "Emma Luczyn"], venue: "The Lansdown, Clifton" },
	{name: "2022-09-21", path: "events/2022-09-21", speakers: ["Fyonafinn", "Athena Cauley-Yu", "Tobias Newbigin"], venue: "The Stag &amp; Hounds, Old Market" },
	{name: "2022-11-23", path: "events/2022-11-23", speakers: ["Tozer", "Nick Hand"], venue: "Greenbank, Easton" },
	{name: "2023-01-18", path: "events/2023-01-18", speakers: ["Flora Fricker", "Jamie Clarker"], venue: "Gather Round, St. Paul’s" },
	{name: "2023-03-22", path: "events/2023-03-22", speakers: ["Elliot Jay Stocks", "Sophia Tai", "Ellen Bills"], venue: "Letterpress Collective" },
	{name: "2023-05-17", path: "events/2023-05-17", speakers: ["Rhiannon Daniels", "John McTague", "Stephen Glendinning"], venue: "The Lansdown, Clifton" },
	{name: "2023-06-29", path: "events/2023-06-29", speakers: ["Josh Saunders", "Filip Paldia"], venue: "Walcot Chapel, Bath" },
	{name: "2023-08-99", path: "", speakers: ["TBA", "TBA"], venue: "TBA" },
]

const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

const fetchOptions = {};
//fetchOptions.headers = { "Authorization": `Bearer ${YOUR-TOKEN}` };

/*
fetch ("https://api.github.com/repos/letterluvvers/letterluvvers.github.io/contents/events/", fetchOptions).then(function(response) {
	return response.json();
}).then(function(data) {
*/

{
const data = dataCache;

	const today = new Date();
	const todayStr = today.toISOString().substr(0, 10);

	// list the files
	console.log(data);

	// transform data into events
	const events = [];
	data.forEach(item => {
		let match;
		if (match = item.name.match(/^\d{4}-\d{2}(-\d{2})?$/)) {
			events.push({
				date: match[0],
				path: item.path,
				name: item.name,
				tile: item.path ? "events/" + item.name + "/tile.jpg" : "",
				speakers: item.speakers,
				venue: item.venue,
			});
		}
	})

	// sort events by reverse date
	events.sort((a, b) => {
		if (a.date < b.date) {
			return 1;
		} else if (a.date > b.date) {
			return -1;
		} else {
			return 0;
		}
	});

	// give each event a number
	events.forEach((event, index) => {
		event.number = events.length - index;
	});

	const eventsDiv = document.querySelector("#events");
	events.forEach(event => {

		const dateElements = {
			day: parseInt(event.date.substr(8, 2), 10),
			month: months[parseInt(event.date.substr(5, 2), 10) -1], 
			year: parseInt(event.date.substr(0, 4), 10),
		};
		const eventDiv = document.createElement("div");
		eventDiv.classList.add("event", "bubble");

		const colL = document.createElement("div");
		const colR = document.createElement("div");
		const scroller = document.createElement("div");
		colR.style.position = "relative";
		colR.style.width = "100%";
		colR.classList.add("right");
		colR.style.overflow = "hidden";

		colL.innerHTML = "";
		colL.innerHTML += `<h2>Letter Luvvers #` + event.number + `</h2>`;
		if (event.date <= todayStr) {
			colL.innerHTML += `<em>` + dateElements.day + " " + dateElements.month + " " + dateElements.year + `</em><br>`;
		} else {
			if (dateElements.day == 99) {
				colL.innerHTML += `<em>upcoming!</em><br>`;
			}
			else {
				colL.innerHTML += `<em>` + dateElements.day + " " + dateElements.month + " " + dateElements.year + `</em><br>`;
			}
		}
		console.log(event.speakers)
		colL.innerHTML += `<strong>` + event.speakers.join(", ") + `</strong><br>`;
		colL.innerHTML += event.venue + `<br>`;

		if (event.tile) {
			const img = document.createElement("img");
			img.src = event.tile;
			img.width = 300;
			img.height = 300;
			//colR.append(img);
			scroller.append(img);
		}
		else {
			const divTemp = document.createElement("div");
			divTemp.innerHTML = "?";
			divTemp.style.paddingTop = "70px";
			divTemp.style.backgroundColor = "white";
			divTemp.style.width = "300px";
			divTemp.style.height = "230px";
			divTemp.style.fontSize = "100px";
			divTemp.style.textAlign = "center";
			//colR.append(divTemp);
			scroller.append(divTemp);
		}

		// start reading images, attach them to colR div
		getImages(event.path, scroller);

		scroller.classList.add("scroller");
		scroller.style.position = "relative";
		scroller.style.overflowX = "auto";
		scroller.style.overflowY = "hidden";
		scroller.style.whiteSpace = "nowrap";
		colR.append(scroller);

		const fadeOnTop = document.createElement("div");
		fadeOnTop.classList.add("fade");
		fadeOnTop.style.position = "absolute";
		fadeOnTop.style.top = "0";
		fadeOnTop.style.left = "0";
		fadeOnTop.style.width = "100%";
		fadeOnTop.style.height = "100%";
		fadeOnTop.style.backgroundImage = "linear-gradient(to right, rgba(255,255,255,0) 90%, var(--panel-background-color) 100%)";
		//fadeOnTop.style.backgroundColor = "red";
		fadeOnTop.style.pointerEvents = "none";
		colR.append(fadeOnTop);


		eventDiv.append(colL, colR);
		eventsDiv.append(eventDiv);


		//"events/" + item.name + "/tile.jpg"


	});

//});
}


</script>
</html>
